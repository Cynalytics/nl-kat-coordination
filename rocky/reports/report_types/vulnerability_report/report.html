{% load i18n %}

{% if data %}
    <div class="horizontal-scroll">
        <table>
            <caption class="visually-hidden">{% translate "Basic example table:" %}</caption>
            <thead>
                <tr>
                    <th scope="col">{% translate "Vulnerabilities" %}</th>
                    <th scope="col">{% translate "Risk level" %}</th>
                    <th scope="col">{% translate "Occurrences" %}</th>
                    <th scope="col">{% translate "Details" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for vulnerability_name, vulnerability in data.items %}
                    {% if not vulnerability_name == "total_findings" %}
                        <tr>
                            <td>{{ vulnerability_name }}</td>
                            <td>
                                <span class="{{ vulnerability.cvss.class }}">{{ vulnerability.cvss.risk_level }}</span>
                            </td>
                            <td>{{ vulnerability.occurrences }}</td>
                            <td class="actions">
                                <button class="expando-button"
                                        data-icon-open-class="icon ti-chevron-down"
                                        data-icon-close-class="icon ti-chevron-up"
                                        data-close-label="{% translate "Close details" %}">
                                    {% translate "Open details" %}
                                </button>
                            </td>
                        </tr>
                        <tr class="expando-row">
                            <td colspan="5">
                                <dl>
                                    <div>
                                        <dt>{% translate "Description" %}</dt>
                                        <dd>
                                            {{ vulnerability.description }}
                                        </dd>
                                    </div>
                                    <div>
                                        <dt>{% translate "Advice" %}</dt>
                                        <dd>
                                            {{ vulnerability.advice }}
                                        </dd>
                                    </div>
                                </dl>
                                <table>
                                    <caption class="visually-hidden">{% translate "Basic example table:" %}</caption>
                                    <thead>
                                        <tr>
                                            <th scope="col">{% translate "Findings" %}</th>
                                            <th scope="col"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for finding, finding_details in vulnerability.findings.items %}
                                            <tr>
                                                <td>{{ finding }}</td>
                                                <td class="actions">
                                                    <button class="expando-button"
                                                            data-icon-open-class="icon ti-chevron-down"
                                                            data-icon-close-class="icon ti-chevron-up"
                                                            data-close-label="{% translate "Close details" %}">
                                                        {% translate "Open details" %}
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr class="expando-row">
                                                <td colspan="2">
                                                    {% for key, value in finding_details.items %}
                                                        <dl>
                                                            <div>
                                                                <dt>{{ key }}</dt>
                                                                <dd>
                                                                    {{ value }}
                                                                </dd>
                                                            </div>
                                                        </dl>
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
