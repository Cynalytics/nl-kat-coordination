{% load i18n %}
{% load static %}

<script nonce="{{ request.csp_nonce }}"
        src=" https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js "></script>
<section id="cynalytics-report">
    <div class="report-container">
        <div class="graph-container">
            <canvas id="open-ports-graph" width="100" height="100">
                Graph could not be displayed
            </canvas>
        </div>
        <div class="port-info-container">
            {% for open_port in data.open_ports %}
                <div>
                    {% if open_port.0 == "common" %}
                        <p class="open-common-port">
                            <span>common</span>
                            <br />
                            port: {{ open_port.1 }}
                        </p>
                    {% elif open_port.0 == "dangerous" %}
                        <p class="open-dangerous-port">
                            <span>dangerous</span>
                            <br />
                            port: {{ open_port.1 }}
                        </p>
                    {% elif open_port.0 == "critical" %}
                        <p class="open-critical-port">
                            <span>critical</span>
                            <br />
                            port: {{ open_port.1 }}
                        </p>
                    {% else %}
                        <p class="port-info">
                            <span>open</span>
                            <br />
                            port: {{ open_port.1 }}
                        </p>
                    {% endif %}
                </div>
            {% endfor %}
            <script type="module" nonce="{{ request.csp_nonce }}">
                (async function () {
                    const data = {{data.chart|safe}};

                    new Chart(document.getElementById("open-ports-graph"), {
                        type: "doughnut",
                        data: {
                            labels: data.map((row) => row.label),
                            datasets: [
                                {
                                    label: "Open ports",
                                    data: data.map((row) => row.count),
                                    backgroundColor: [
                                    'rgb(36, 173, 36)',
                                    'rgb(255, 166, 0)',
                                    'rgb(221, 81, 81)',
                                    'rgb(136, 127, 112)'
                                    ],
                                    weight: 5,
                                },
                            ],
                        },
                        options: {"rotation": 120, },
                    });
                })();
            </script>
        </div>
    </div>
</section>
